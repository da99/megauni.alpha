#!/usr/bin/env bash
# -*- bash -*-
#
# Examples:
#    bin/model create Chat
#    bin/model file   Chat Chat_Room_Fav
#

cmd="$1"
class="$2"
instance="$(echo $class | tr '[A-Z]' '[a-z]')"

set -u -e -o pipefail

compile_all () {
  mkdir -p Server/$class/model
  mkdir -p tests/$class


  bin/template model $class "Server/$class/model.rb"

  bin/template model.action $class "Server/$class/model/create.rb" create
  bin/template model.action $class "Server/$class/model/read.rb"   read
  bin/template model.action $class "Server/$class/model/update.rb" update
  bin/template model.action $class "Server/$class/model/trash.rb"  trash
  bin/template model.action $class "Server/$class/model/delete.rb" delete

  bin/template routes $class "Server/$class/routes.rb"

  bin/template test $class "tests/$class/01-create.rb"    "create"
  bin/template test $class "tests/$class/02-read.rb"      "read"
  bin/template test $class "tests/$class/03-update.rb"    "update"
  bin/template test $class "tests/$class/04-trash.rb"     "trash"
  bin/template test $class "tests/$class/05-delete.rb"    "delete"

}


case "$cmd" in
  create)
    compile_all
    ;;

  *)
    echo "Unknown command: $@"
    exit 1
    ;;

esac


