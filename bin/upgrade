#!/usr/bin/env bash
# -*- bash -*-
#

set -u
set -e
set -o pipefail
set -x

if [[ ! "$@" == *skip_os* ]]
then
  sudo apt-get update
  sudo apt-get upgrade
  sudo npm update
fi

if [[ ! "$@" == *skip_npm* ]]
then
  npm prune
  npm install
  npm update
  npm rebuild

  # If you use hiredis, be sure to rebuild it
  # whenever you upgrade your version of node.
  # There are mysterious failures that can happen
  # between node and native code modules after a
  # node upgrade.
  # npm rebuild hiredis
fi

js="Client/js"
base_file="$js/okdoki.js"
function re_download {
  rm -f "$1"
  wget -O "$1" "$2"
  cat "$1"   >> "$base_file"
}

echo "" > "$base_file"
re_download "$js/underscore.js"  "http://underscorejs.org/underscore-min.js"
re_download "$js/jquery.js"      "http://code.jquery.com/jquery-1.9.1.min.js"
re_download "$js/backbone.js"    "http://backbonejs.org/backbone-min.js"
re_download "$js/doT.js"         "https://raw.github.com/olado/doT/master/doT.min.js"
re_download "$js/Hyper_JS.js"    "https://raw.github.com/da99/Hyper_JS/master/Hyper_JS.js"


# re_download "$js/Sammy.js"       "https://raw.github.com/quirkey/sammy/master/lib/sammy.js"
# re_download "$js/handlebars.js"  "https://raw.github.com/wycats/handlebars.js/master/dist/handlebars.js"
# "https://raw.github.com/padolsey/jQuery-Plugins/master/sortElements/jquery.sortElements.js"
# rm -f "$js/jquery.sortElements.js"
# rm -f "$js/underscore-min.js"


is_done="true"

