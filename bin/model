#!/usr/bin/env bash
# -*- bash -*-
#
# Examples:
#    bin/model create Chat
#    bin/model file   Chat Chat_Room_Fav
#
cmd="$1"
model="$2"
file_name="$3"
set -u -e -o pipefail

function compile_template {
  mkdir -p Server/$model
  class_name="$model"
  db_table_name="$model"

  tmpl="Server/App/model.template.js"
  if [[ -z "$file_name" ]]
  then
    new_file="Server/$model/model.js"
  else
    new_file="Server/$model/$file_name.js"
    class_name="$file_name"
    db_table_name="${model}_${file_name}"
  fi

  if [[ -f "$new_file" ]]
  then
    echo "skipping creationg of file:"
  else
    sed "s/MODEL/$class_name/g" "$tmpl" >> "$new_file"
    sed "s/DB_TABLE_NAME/${db_table_name}/g" "$new_file" -i
  fi

  echo "$new_file"
}

case "$cmd" in
  create)
    compile_template
    bin/route create "$model" "$file_name"
    ;;

  *)
    echo "Unknown command: $@"
    exit 1
    ;;

esac


