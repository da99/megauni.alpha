#!/usr/bin/env bash
# -*- bash -*-
#
# Examples:
#    bin/model create Chat
#    bin/model file   Chat Chat_Room_Fav
#

cmd="$1"
class="$2"
instance="$(echo $class | tr '[A-Z]' '[a-z]')"

set -u -e -o pipefail

compile_all () {
  mkdir -p Server/$class/model
  mkdir -p tests/$class


  tmpl="Server/Okdoki/templates/model.rb"
  bin/template model $class "Server/$class/model.rb"

  tmpl="Server/Okdoki/templates/model.action.rb"
  bin/template create $class "Server/$class/model/create.rb"
  bin/template read   $class "Server/$class/model/read.rb"
  bin/template update $class "Server/$class/model/update.rb"
  bin/template trash  $class "Server/$class/model/trash.rb"
  bin/template delete $class "Server/$class/model/delete.rb"

  tmpl="Server/Okdoki/templates/routes.rb"
  bin/template route $class "Server/$class/routes.rb"

  tmpl="Server/Okdoki/templates/test.rb"
  bin/template test $class "tests/$class/01-create.rb"    "create"
  bin/template test $class "tests/$class/02-read.rb"      "read"
  bin/template test $class "tests/$class/03-update.rb"    "update"
  bin/template test $class "tests/$class/04-trash.rb"     "trash"
  bin/template test $class "tests/$class/05-delete.rb"    "delete"

}


case "$cmd" in
  create)
    compile_all
    ;;

  *)
    echo "Unknown command: $@"
    exit 1
    ;;

esac


