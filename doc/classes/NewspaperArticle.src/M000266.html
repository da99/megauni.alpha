<?xml version="1.0" encoding="iso-8859-1"?>
<!DOCTYPE html 
     PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
     "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html>
<head>
  <title>find_validation_errors (NewspaperArticle)</title>
  <meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1" />
  <link rel="stylesheet" href="../.././rdoc-style.css" type="text/css" media="screen" />
</head>
<body class="standalone-code">
  <pre><span class="ruby-comment cmt"># File models/newspaper_article.rb, line 113</span>
  <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">find_validation_errors</span>
  
    <span class="ruby-comment cmt"># === :current_editor</span>
    <span class="ruby-keyword kw">if</span> <span class="ruby-operator">!</span><span class="ruby-identifier">authorized_editor?</span>( <span class="ruby-identifier">current_editor</span> )
        <span class="ruby-identifier">raise</span> <span class="ruby-node">&quot;Unauthorized editor: #{current_editor.inspect}&quot;</span>
    <span class="ruby-keyword kw">end</span>
    
    <span class="ruby-comment cmt"># === :title</span>
    <span class="ruby-identifier">require_string!</span> <span class="ruby-identifier">:title</span>

    <span class="ruby-comment cmt"># === check for either :summary or :body</span>
    <span class="ruby-identifier">require_at_least_one_string!</span>( <span class="ruby-identifier">:summary</span>, <span class="ruby-identifier">:body</span> )


    <span class="ruby-comment cmt"># === check to see if :author is an authorized owner or team member</span>
    <span class="ruby-identifier">latest_author</span>    = <span class="ruby-identifier">author_dataset</span>.<span class="ruby-identifier">first</span>
    <span class="ruby-identifier">latest_newspaper</span> = <span class="ruby-identifier">newspaper_dataset</span>.<span class="ruby-identifier">first</span>
    
    <span class="ruby-keyword kw">if</span> <span class="ruby-operator">!</span><span class="ruby-identifier">latest_author</span>  
      <span class="ruby-identifier">raise</span>( <span class="ruby-constant">UnauthorizedAuthor</span>, <span class="ruby-value str">&quot;Author has not be set correctly. Most likely a programmer error. Contact support to complain.&quot;</span> )
    <span class="ruby-keyword kw">end</span>
    
    <span class="ruby-keyword kw">if</span> <span class="ruby-operator">!</span><span class="ruby-identifier">latest_newspaper</span>.<span class="ruby-identifier">authorized_author?</span>(<span class="ruby-identifier">latest_author</span>) 
        <span class="ruby-identifier">raise</span>( <span class="ruby-constant">UnauthorizedAuthor</span>, <span class="ruby-node">&quot;Author id: #{self[:author_id]}, Newspaper id: #{self[:newspaper_id]}&quot;</span> ) 
    <span class="ruby-keyword kw">end</span>
    
    
    <span class="ruby-comment cmt"># === :published_at</span>
    <span class="ruby-keyword kw">self</span>[<span class="ruby-identifier">:published_at</span>] <span class="ruby-operator">||=</span> <span class="ruby-constant">Time</span>.<span class="ruby-identifier">now</span>.<span class="ruby-identifier">utc</span>

    <span class="ruby-comment cmt"># === :status</span>
    <span class="ruby-keyword kw">self</span>[<span class="ruby-identifier">:status</span>] = <span class="ruby-constant">Integer</span>(<span class="ruby-keyword kw">self</span>[<span class="ruby-identifier">:status</span>])
    <span class="ruby-identifier">require_valid_menu_item!</span>( <span class="ruby-identifier">:status</span> )

    <span class="ruby-comment cmt"># === check to see if :section_id is part of the newspaper sections</span>
    <span class="ruby-keyword kw">self</span>[<span class="ruby-identifier">:section_id</span>] = <span class="ruby-keyword kw">self</span>[<span class="ruby-identifier">:section_id</span>].<span class="ruby-identifier">to_i</span>
    <span class="ruby-keyword kw">unless</span> <span class="ruby-keyword kw">self</span>[<span class="ruby-identifier">:section_id</span>].<span class="ruby-identifier">zero?</span>
      <span class="ruby-identifier">require_valid_menu_item!</span>(
        <span class="ruby-identifier">:section_id</span>, 
        <span class="ruby-value str">&quot;Invalid section.&quot;</span>, 
        <span class="ruby-identifier">newspaper</span>.<span class="ruby-identifier">all_sections_dataset</span>.<span class="ruby-identifier">select</span>(<span class="ruby-identifier">:id</span>).<span class="ruby-identifier">all</span> 
      )
    <span class="ruby-keyword kw">end</span>
  <span class="ruby-keyword kw">end</span></pre>
</body>
</html>