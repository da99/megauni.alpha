#!/usr/bin/env bash
# -*- bash -*-
#
set -u
bin/kill_test_server
set -e

# http://www.ibm.com/developerworks/aix/library/au-learningtput/
green_bg=$(tput setb 2)
white=$(tput setaf 7)
reset_color=$(tput sgr0)
bold_white_on_green=$(tput bold)${white}${green_bg}
bold_white=$(tput bold)${white}

PORT=5001

echo ""
echo "Starting server on $PORT..."
PORT=$PORT bin/start &

echo ""
echo "Running phantomjs/casperjs tests..."
bin/migrate reset
PORT=$PORT casperjs test/01-casper.js $PORT
(sleep 2 && bin/kill_test_server) &
PORT=$PORT casperjs test/02-casper.js $PORT

echo ""
echo "Running nodejs/mocha tests..."
bin/mocha

trap "bin/kill_test_server" EXIT
# echo -e "${bold_white}   ALL TESTS ENDED   ${reset_color}"



