#!/usr/bin/env bash
# -*- bash -*-
#
# Examples:
#    bin/model create Chat
#    bin/model routes Chat
#    bin/model file   Chat Chat_Room_Fav
#
model=$2
file_name=$3
set -u -e -o pipefail

function compile_template {
  mkdir -p Server/$model
  model_name="$model"

  tmpl="Server/App/$1.template.js"
  if [[ -z "$file_name" ]]
  then
    new_file="Server/$model/$1.js"
  else
    new_file="Server/$model/$file_name.js"
    model_name="$file_name"
  fi

  if [[ -f "$new_file" ]]
  then
    echo "skipping creationg of file:"
  else
    sed "s/MODEL/$model_name/g" "$tmpl" >> "$new_file"
  fi

  echo "$new_file"
}

case "$1" in
  file)
    compile_template "model"
    ;;

  create)
    compile_template "model"
    bin/model create_routes "$model"
    ;;

  create_routes)
    compile_template "routes"
    ;;

  *)
    echo "Unknown command: $@"
    exit 1
    ;;

esac


