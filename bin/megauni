#!/usr/bin/env mksh
# -*- mksh -*-
#
#
THIS_DIR="$(mksh_setup dirname_of_bin "$0")"
PORT="${PORT:-4567}"
action="$1"; shift

IS_DEV="$IS_DEV"
if [[ -n "$IS_DEV" ]]; then
  dir="$(pwd)"
  export JAR="$dir/tmp/cookies.txt"
  export PID="$dir/tmp/{$PORT}.pid"
  export LOG="$dir/tmp/log.txt"
fi

set -u -e -o pipefail


case "$action" in

  help|--help)
    mksh_setup print_help $0
    exit 0
    ;;

  *)
    # === IF: bin/lib file:
    func_file="$THIS_DIR/bin/lib/${action}.sh"
    if [[ -s "$func_file" ]]; then
      source "$func_file"
      "$action" $@
      exit 0
    fi

    file="$( echo node_modules/*/bin/$action )"
    args="$@"

    if [[ -f "$file"  ]]; then
      $0 iojs $file "$@"
      exit 0
    fi

    echo "Unknown action: $action" 1>&2
    exit 1
    ;;

esac # === case $action



