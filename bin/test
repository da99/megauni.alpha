#!/usr/bin/env bash
# -*- bash -*-
#
#   bin/test MODEL
#
# --- These are all equivalent:
#
#   bin/bundle exec bacon tests/MODEL/0X-action.rb
#   bin/test   fast tests/MODEL/0X-action.rb
#   bin/test   MODEL action
#
# --- or with `bin/migrate reset`:
#   bin/test   tests/MODEL/0X-action.rb
#
skip=$1
fast_file="$(echo tests/$1/*-$2.rb)"
fast_dir="$(echo tests/$1)"

set -e -u -o pipefail

if [[ -f "$fast_file" ]]; then
  shift
  shift
  bin/bundle exec bacon $@ "$fast_file"
  exit 0
fi

if [[ -d "$fast_dir" ]]; then
  shift
  for d in "$fast_dir"/*
  do
    bin/bundle exec bacon $@ "$d"
  done
  exit 0
fi

if [[ "$skip" == "fast" ]]
then
  shift
else
  bin/migrate reset > /dev/null
fi

if [[ ! -z "$@" ]]
then
  bin/bundle exec bacon "$@"
  exit 0
fi

. bin/model_list
test_mods=( Ok )
for m in ${mods[@]}
do
  test_mods+=( "$m" )
done

for m in ${test_mods[@]}
do
  for f in tests/$m/*.rb
  do
    bin/bundle exec bacon $f
  done
done # === mod loop


# http://www.ibm.com/developerworks/aix/library/au-learningtput/
green_bg=$(tput setb 2)
white=$(tput setaf 7)
reset_color=$(tput sgr0)
bold_white_on_green=$(tput bold)${white}${green_bg}
bold_white=$(tput bold)${white}






