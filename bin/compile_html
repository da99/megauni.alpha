#!/usr/bin/env bash
# -*- bash -*-
#
#
set -u -e -o pipefail

file=$1
shift

if [[ "$file" =~ "all" ]]
then
  files=$( $UP/util/files_with_ext Public/ .rb | grep -v layout.rb )
  for f in $files
  do
    $0 $f
  done
  exit 0
fi

html=${file/.rb/.mustache.rb}

tmp=$(mktemp)
bin/bundle exec dot_why ./Public/layout.rb $file $@ | pandoc > $tmp
bin/bundle exec mustache -c $tmp > $html

rm $tmp
echo -e "\n=== wrote: $html\n"

