#!/usr/bin/env bash
# -*- bash -*-
#
cmd="$1"
set -u -e -o pipefail

if [ "list" != "$cmd" ]
then
  list="$(bin/npm_link list)"
fi

case "$cmd" in
  ensure_none)
    if [ "" != "$list"  ]
    then
      echo "$list"
      exit 1
    fi
    ;;
  remove_and_reinstall)
    for i in $list
    do
      trash-put "$i"
    done
    npm install
    ;;
  list)
    find node_modules/  -maxdepth 1 -type l
    ;;
  *)
    if [ "$cmd" == "" ]
    then
      echo "missing name of package"
      exit 1
    fi

    target="node_modules/$cmd"
    if [ -d "$target" ]
    then
      trash-put "$target"
    fi
    ln -s "/gems/$cmd" "$target"
    ;;
esac


