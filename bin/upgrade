#!/usr/bin/env bash
# -*- bash -*-
#

set -u
set -e
set -o pipefail
set -x

if [ "skip_os" != "$@" ]
then
  sudo apt-get update
  sudo apt-get upgrade
  sudo npm update
fi

npm install
npm update

# If you use hiredis, be sure to rebuild it
# whenever you upgrade your version of node.
# There are mysterious failures that can happen
# between node and native code modules after a
# node upgrade.
# npm rebuild hiredis

js="public/assets/js"
function re_download {
  if [ -f "$1" ];
  then rm "$1";
  fi

  wget -O "$1" "$2"
}

re_download "$js/jquery.sortElements.js" "https://raw.github.com/padolsey/jQuery-Plugins/master/sortElements/jquery.sortElements.js"
re_download "$js/underscore-min.js"      "https://raw.github.com/documentcloud/underscore/master/underscore-min.js"

is_done="true"

