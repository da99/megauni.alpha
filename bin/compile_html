#!/usr/bin/env bash
# -*- bash -*-
#
#
set -u -e -o pipefail

file=$1
shift

if [[ "$file" =~ "all" ]]
then
  files=$( $UP/util/files_with_ext Public/ .rb | grep -v layout.rb )
  for f in $files
  do
    $0 $f
  done
  exit 0
fi

html=${file/.rb/.mustache.rb}

tmp=$(mktemp)
bin/bundle exec dot_why ./Public/layout.rb $file "$@" | pandoc > $tmp

bin/bundle exec ruby -e "require('mustache'); puts Mustache::Template.new(File.read('$tmp')).compile;"  > $html

rm -f $tmp
echo -e "=== wrote: $html"

